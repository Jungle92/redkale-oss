
<html>
    <head>
        <title>控制中心</title>
        <meta http-equiv="content-type" content="text/html;charset=utf-8">
        <link rel='stylesheet' type='text/css' href='/framework/easyui/themes/gray/easyui.css'> 
        <link rel='stylesheet' type='text/css' href='/framework/easyui/themes/icon.css'>

        <script type='text/javascript' src='/framework/easyui/jquery.min.js'></script> 
        <script type='text/javascript' src='/framework/easyui/jquery.easyui.min.js'></script> 
        <script type='text/javascript' src='/framework/easyui/easyui-lang-zh_CN.js'></script> 
        <script type='text/javascript' src='/framework/ckeditor/ckeditor.js'></script> 
        <script type='text/javascript' src='/framework/ckeditor/adapters/jquery.js'></script> 
        <script type='text/javascript' src='framework/extends.js'></script>
        <script type='text/javascript' src='/pipes/dync/mydata'></script> 

        <style type="text/css">
            a {text-decoration:none;}
            .datagrid-cell-rownumber table {width: 100%;}
            .datagrid-cell-rownumber th {width:150px;text-align: right;}
            .datagrid-cell-rownumber td {text-align: left;}
        </style>
    </head>
    <body id="mainLayout" class="easyui-layout">
        <div style="position: absolute;z-index:10;right: 0;top: 19px;"></div>  
        <div data-options="region:'north'" style="height: 60px; overflow: hidden;border-top:0px;background: url('/css/images/logo.png') no-repeat;" class="combo-arrow">  
            <div id="sessioninfo" style="position: absolute; right: 50px; top: 5px;"></div>  
        </div>  
        <div data-options="region:'west',split:true,border: true" title="" style="width: 220px; padding:10px;"> 
            <ul id="mainMenu"></ul> 
        </div> 
        <div data-options="region:'center'" style="border-top: 0px;border-left: 0px;border-bottom: 0px;">
            <div id="mainTabs" class="easyui-tabs">
                <div title="我的主页" data-options="iconCls:'ext-icon-heart',closable:true,fit:true,href:'/modules/sys/home.html'"></div>
            </div>
        </div>
        <div id="menu" class="easyui-menu" style="width:150px;">
            <div id="m-refresh">刷新</div>
            <div class="menu-sep"></div>
            <div id="m-closeall">全部关闭</div>
            <div id="m-closeother">除此之外全部关闭</div>
            <div class="menu-sep"></div>
            <div id="m-close">关闭</div>
        </div>
        <div data-options="region:'south'" style="height: 30px; overflow: hidden;border: 0px;">
            <div class="panel-header panel-title" style="text-align: center;border-top:0px;">Redkale Co., Ltd.</div>
        </div>
        <script>
            var Platform = window['Platform'] || {};
            $(function () {
                //-------------------------------------------------------------------------------------------------------------------
                Platform.findTextFromArray = function (array, value, idField, textField) {
                    if (!idField) idField = "value";
                    if (!textField) textField = "text";
                    if (!array) return "";
                    for (var i = 0; i < array.length; i++) {
                        if (array[i][idField] === value)
                            return array[i][textField];
                    }
                    return "";
                };
                Platform.DateFormatter = function (value, row, i) {
                    return value ? new Date(value) : "";
                };
                Platform.DayFormatter = function (value, row, i) {
                    return value ? new Date(value).toDayString() : "";
                };
                //-------------------------------------------------------------------------------------------------------------------
                if (window['system_userinfo'] && system_userinfo.userid) {
                    document.getElementById("sessioninfo").innerHTML = '欢迎您，<span id="curruserfeat" style="cursor:pointer;">' + system_userinfo.chname + '</span>  <a href="/pipes/user/logout">注销</a>';
                }
                if (/msie/.test(navigator.userAgent.toLowerCase()) || (window.external && window.external.twGetRunPath && window.external.twGetRunPath().toLowerCase().indexOf("360se") > -1)) {
                    alert('本站不支持低等的浏览器访问，请更换Google Chrome浏览器！');
                    return;
                }
                //-------------------------------------------------------------------------------------------------------------------
                var mainTabs = $('#mainTabs');
                var currTitle = "";
                //绑定tabs的右键菜单
                //绑定tabs的右键菜单
                mainTabs.tabs({
                    onContextMenu: function (e, title) {
                        e.preventDefault();
                        $('#menu').menu('show', {
                            left: e.pageX,
                            top: e.pageY
                        }).data("tabTitle", title);
                    }
                });
                //刷新
                $("#m-refresh").click(function () {
                    var currTab = mainTabs.tabs('getSelected');	//获取选中的标签项
                    console.log(currTab)
                    console.log(currTab.panel('options').href);
                    var url = currTab.panel('options').href;      //获取选项卡href属性
                    /* 重新设置该标签 */
                    $('#mainTabs').tabs('update', {
                        tab: currTab,
                        options: {
                            content: '<iframe style="width:100%;height:100%;" scrolling="auto" frameborder="0" src="' + url + '"></iframe>'
                        }
                    })
                });
                //关闭所有
                $("#m-closeall").click(function () {
                    $(".tabs li").each(function (i, n) {
                        console.log(n)
                        var title = $(n).text();
                        console.log(title)
                        mainTabs.tabs('close', title);
                    });
                });
                //除当前之外关闭所有
                $("#m-closeother").click(function () {
                    var currTab = mainTabs.tabs('getSelected');
                    currTitle = currTab.panel('options').title;
                    $(".tabs li").each(function (i, n) {
                        var title = $(n).text();
                        if (currTitle !== title) {
                            $('#mainTabs').tabs('close', title);
                        }
                    });
                });
                //关闭当前
                $("#m-close").click(function () {
                    var currTab = mainTabs.tabs('getSelected');
                    currTitle = currTab.panel('options').title;
                    mainTabs.tabs('close', currTitle);
                });
                mainTabs.tabs({
                    width: mainTabs.parent().width(),
                    height: mainTabs.parent().height()
                });
                $('#mainMenu').tree({
                    data: window['system_sysmenus'],
                    onClick: function (node) {
                        if (!node.url)
                            return;
                        var tabs = $('#mainTabs');
                        var opts = {
                            id: 'moduleTab',
                            title: node.text,
                            closable: true,
                            iconCls: node.iconCls,
                            width: tabs.parent().width(),
                            height: tabs.parent().height(),
                            ajaxOptions: {async: true, cache: true},
                            loadingMessage: '页面加载中……',
                            href: node.url,
                            border: false,
                            fit: true,
                            onLoad: function () {
                                $(this).attr({id: "tab" + new Date().getTime()});
                            }
                        };
                        if (tabs.tabs('exists', opts.title)) {
                            tabs.tabs('select', opts.title);
                        } else {
                            tabs.tabs('add', opts);
                        }
                    }
                });
            });
        </script>
    </body>
</html>
