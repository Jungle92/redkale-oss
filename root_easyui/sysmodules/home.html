<style>
    .helpt {border-collapse:collapse;border-spacing:0;border-left:1px solid #888;border-top:1px solid #888;background:#efefef;margin-left: 30px;}
    .helpt th, .helpt td{border-right:1px solid #888;border-bottom:1px solid #888;padding:5px 15px;word-break: keep-all;white-space:nowrap;font-size: 12px;}
    .helpt th{font-weight:bold;background:#ccc;}
    .helpt a{text-decoration:none;}
</style>
<div style="text-align: center;margin-top: 30px;">
    <table class="helpt">
        <tr><th>功能模块</th><th>功能描述</th><th>上线时间</th></tr>
        <tr><td>XXX功能</td><td>  此处说明功能描述.</td><td>2016-03-01</td></tr>
        
    </table>
</div>
<div id="module-login-dialog" style="display:none;">
    <form id="module-login-form">
        <table class="datagrid-cell-rownumber" style="width: 100%;">
            <tr>
                <th></th>
                <td style="height: 50px;"></td>
                <td style="width: 120px;"></td>
            </tr>
            <tr>
                <th style="padding-right: 20px;">用户名:</th>
                <td><input id="glogin_account" name="data.account" class="easyui-validatebox" data-options="required:true" /></td>
                <td></td>
            </tr>
            <tr>
                <th></th>
                <td style="height: 25px;"></td>
            </tr>
            <tr>
                <th style="padding-right: 20px;">密 码:</th>
                <td><input id="glogin_password" name="data.password" type="password" class="easyui-validatebox" data-options="required:true" /></td>
                <td></td>
            </tr>
        </table>
    </form>
</div>
<div id="module-changepwd-dialog" style="display:none;">
    <form id="module-changepwd-form">
        <table class="datagrid-cell-rownumber" style="width: 100%;">
            <tr>
                <th></th>
                <td style="height: 25px;"></td>
                <td style="width: 100px;"></td>
            </tr>
            <tr>
                <th>旧 密 码:</th>
                <td><input name="data.oldpwd" type="password" class="easyui-validatebox" data-options="required:true" /></td>
                <td></td>
            </tr>
            <tr>
                <th></th>
                <td style="height: 20px;"></td>
            </tr>
            <tr>
                <th>新 密 码:</th>
                <td><input name="data.newpwd" type="password" class="easyui-validatebox" data-options="required:true" /></td>
                <td></td>
            </tr>
            <tr>
                <th></th>
                <td style="height: 20px;"></td>
            </tr>
            <tr>
                <th>确认密码:</th>
                <td><input name="data.newpwd2" type="password" class="easyui-validatebox" data-options="required:true" /></td>
                <td></td>
            </tr>
        </table>
    </form>
</div>
<script>
    (function () {
        $('#curruserfeat').click(function () {
            var winDialog = $("#module-changepwd-dialog");
            var form = $("#module-changepwd-form");
            form.form('reset');
            winDialog.show().dialog({
                title: '修改密码',
                iconCls: 'ext-icon-user',
                width: 400,
                height: 250,
                shadow: true,
                modal: true,
                buttons: [{
                        text: '确 定',
                        iconCls: 'ext-icon-login',
                        handler: function () {
                            if (!form.form('validate')) return;
                            var json = form.serializeJson("data");
                            if (json.newpwd !== json.newpwd2) {
                                alert("两次新密码输入不一致");
                                return;
                            }
                            $.ajax({
                                async: false,
                                cache: false,
                                dataType: "json",
                                data: {
                                    "oldpwd": $.md5(json.oldpwd),
                                    "newpwd": $.md5(json.newpwd),
                                },
                                url: '/pipes/user/changepwd',
                                error: function () {//请求失败处理函数
                                    alert('请求失败');
                                },
                                success: function (data) {
                                    if (!data.success) {
                                        if (data.retcode === 1010021) {
                                            alert("新密码未加密!");
                                        } else if (data.retcode === 1010020) {
                                            alert("旧密码错误!");
                                        } else {
                                            alert("密码修改失败!");
                                        }
                                        return;
                                    }
                                    alert("密码已修改成功");
                                    $("#module-changepwd-dialog").dialog('close');
                                }
                            });
                        }
                    }]
            });
        });
        var showLoginDialog = function () {
            var winDialog = $("#module-login-dialog");
            var form = $("#module-login-form");
            form.form('reset');
            var loginfunc = function () {
                if (!form.form('validate')) return;
                $.ajax({
                    async: false,
                    cache: false,
                    dataType: "json",
                    data: {
                        "bean": form.serializeJsonString("data"),
                    },
                    url: '/pipes/user/login',
                    error: function () {//请求失败处理函数
                        alert('请求失败');
                    },
                    success: function (data) {
                        if (!data.success) {
                            if (data.retcode === 1001) {
                                alert("用户或密码错误!");
                            } else if (data.retcode === 1002) {
                                alert("用户已被禁用!");
                            } else {
                                alert("登陆失败!");
                            }
                            return;
                        } else {
                            if (window.localStorage) {
                                window.localStorage['glogin_account'] = $('#glogin_account').val();
                            }
                        }
                        window.location.reload();
                    }
                });
            };
            $('#glogin_account').keyup(function (e) {
                if (e.keyCode == 13) {
                    $('#glogin_password').focus();
                }
            });
            $('#glogin_password').keyup(function (e) {
                if (e.keyCode == 13) {
                    loginfunc();
                }
            });
            winDialog.show().dialog({
                title: '用户登陆',
                iconCls: 'ext-icon-user',
                width: 400,
                height: 250,
                shadow: true,
                modal: true,
                buttons: [{
                        text: '登 陆',
                        iconCls: 'ext-icon-login',
                        handler: function () {
                            loginfunc();
                        }
                    }]

            });
            if (window.localStorage && window.localStorage['glogin_account']) {
                $('#glogin_account').val(window.localStorage['glogin_account']);
                $('#glogin_password').focus();
            }
        };

        if (!window['system_memberinfo'] || !system_memberinfo.account) {
            showLoginDialog();
        }
    })();
</script>